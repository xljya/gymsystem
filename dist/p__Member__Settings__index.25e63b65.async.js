"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[730],{94149:function(R,P,n){n.d(P,{Z:function(){return x}});var b=n(1413),m=n(67294),E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},F=E,S=n(91146),h=function(o,v){return m.createElement(S.Z,(0,b.Z)((0,b.Z)({},o),{},{ref:v,icon:F}))},Z=m.forwardRef(h),x=Z},37122:function(R,P,n){n.r(P),n.d(P,{default:function(){return q}});var b=n(15009),m=n.n(b),E=n(99289),F=n.n(E),S=n(5574),h=n.n(S),Z=n(90930),x=n(15133),i=n(25040),o=n(2453),v=n(55102),B=n(78045),y=n(83622),C=n(4393),k=n(78957),M=n(68997),$=n(96074),G=n(11941),j=n(67294),I=n(94149),O=n(1413),H=n(15294),J=n(91146),K=function(D,c){return j.createElement(J.Z,(0,O.Z)((0,O.Z)({},D),{},{ref:c,icon:H.Z}))},W=j.forwardRef(K),Q=W,X=n(87547),w=n(34955),e=n(85893),Y=function(){var D=(0,x.useModel)("@@initialState"),c=D.initialState,r=c==null?void 0:c.currentUser,ee=i.Z.useForm(),re=h()(ee,1),g=re[0],ae=i.Z.useForm(),ne=h()(ae,1),L=ne[0],ue=(0,j.useState)(!1),N=h()(ue,2),T=N[0],A=N[1],se=(0,j.useState)("loading"),U=h()(se,2),V=U[0],p=U[1],z=function(){var t=F()(m()().mark(function d(){var l,u;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,w.Z)("/api/member/get/my",{method:"GET"});case 3:if(l=a.sent,console.log("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u54CD\u5E94\u5B8C\u6574\u5185\u5BB9:",JSON.stringify(l,null,2)),!l){a.next=20;break}if(u=l,l.code===0&&l.data&&(u=l.data),!(u.id&&u.memberAccount)){a.next=15;break}return console.log("\u6210\u529F\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u6570\u636E:",u),g.setFieldsValue({memberName:u.memberName||"",memberAvatar:u.memberAvatar||"",gender:u.gender}),p("ready"),a.abrupt("return",u);case 15:return console.error("\u8FD4\u56DE\u6570\u636E\u4E0D\u662F\u6709\u6548\u7684\u7528\u6237\u4FE1\u606F:",u),p("error"),a.abrupt("return",null);case 18:a.next=23;break;case 20:return console.error("API\u54CD\u5E94\u4E3A\u7A7A"),p("error"),a.abrupt("return",null);case 23:a.next=30;break;case 25:return a.prev=25,a.t0=a.catch(0),console.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u9519\u8BEF:",a.t0),p("error"),a.abrupt("return",null);case 30:case"end":return a.stop()}},d,null,[[0,25]])}));return function(){return t.apply(this,arguments)}}();(0,j.useEffect)(function(){console.log("\u4E2A\u4EBA\u8BBE\u7F6E\u9875\u9762\u521D\u59CB\u5316"),console.log("\u5F53\u524D\u7528\u6237\u4FE1\u606F:",r),z().then(function(t){t?console.log("API\u8BF7\u6C42\u6210\u529F\u83B7\u53D6\u6700\u65B0\u7528\u6237\u4FE1\u606F"):r!=null&&r.id&&(console.log("API\u8BF7\u6C42\u5931\u8D25\u4F46currentUser\u5B58\u5728\uFF0C\u4F7F\u7528currentUser\u6570\u636E"),g.setFieldsValue({memberName:r.memberName||"",memberAvatar:r.memberAvatar||"",gender:r.gender}),p("ready"))}).catch(function(t){console.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5F02\u5E38:",t),r!=null&&r.id&&(g.setFieldsValue({memberName:r.memberName||"",memberAvatar:r.memberAvatar||"",gender:r.gender}),p("ready"))})},[r]);var le=function(){var t=F()(m()().mark(function d(l){var u,f;return m()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(r!=null&&r.id){s.next=3;break}return o.ZP.error("\u7528\u6237\u672A\u767B\u5F55"),s.abrupt("return");case 3:return A(!0),console.log("\u63D0\u4EA4\u7684\u4E2A\u4EBA\u8D44\u6599:",l),s.prev=5,s.next=8,(0,w.Z)("/api/member/update/my",{method:"POST",headers:{"Content-Type":"application/json"},data:{memberName:l.memberName,memberAvatar:l.memberAvatar,gender:l.gender||r.gender}});case 8:if(u=s.sent,console.log("\u66F4\u65B0\u4E2A\u4EBA\u8D44\u6599\u54CD\u5E94:",JSON.stringify(u,null,2)),!(u&&u.code===0||u===!0)){s.next=19;break}if(o.ZP.success("\u66F4\u65B0\u6210\u529F"),!(c!=null&&c.fetchUserInfo)){s.next=17;break}return s.next=15,c.fetchUserInfo();case 15:f=s.sent,f&&(console.log("\u5DF2\u66F4\u65B0\u5168\u5C40\u7528\u6237\u72B6\u6001"),z());case 17:s.next=20;break;case 19:o.ZP.error("\u66F4\u65B0\u5931\u8D25: ".concat((u==null?void 0:u.message)||"\u672A\u77E5\u9519\u8BEF"));case 20:s.next=26;break;case 22:s.prev=22,s.t0=s.catch(5),console.error("\u66F4\u65B0\u4E2A\u4EBA\u8D44\u6599\u9519\u8BEF:",s.t0),o.ZP.error("\u66F4\u65B0\u5931\u8D25: ".concat(s.t0 instanceof Error?s.t0.message:"\u672A\u77E5\u9519\u8BEF"));case 26:return s.prev=26,A(!1),s.finish(26);case 29:case"end":return s.stop()}},d,null,[[5,22,26,29]])}));return function(l){return t.apply(this,arguments)}}(),ie=function(){var t=F()(m()().mark(function d(l){var u;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r!=null&&r.id){a.next=3;break}return o.ZP.error("\u7528\u6237\u672A\u767B\u5F55"),a.abrupt("return");case 3:if(l.newPassword===l.confirmPassword){a.next=6;break}return o.ZP.error("\u4E24\u6B21\u8F93\u5165\u7684\u65B0\u5BC6\u7801\u4E0D\u4E00\u81F4"),a.abrupt("return");case 6:return A(!0),console.log("\u63D0\u4EA4\u5BC6\u7801\u4FEE\u6539\u8BF7\u6C42"),a.prev=8,a.next=11,(0,w.Z)("/api/member/update/password",{method:"POST",headers:{"Content-Type":"application/json"},data:{oldPassword:l.oldPassword,newPassword:l.newPassword,checkPassword:l.confirmPassword}});case 11:u=a.sent,console.log("\u4FEE\u6539\u5BC6\u7801\u54CD\u5E94:",JSON.stringify(u,null,2)),u&&u.code===0||u===!0?(o.ZP.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),L.resetFields()):o.ZP.error("\u5BC6\u7801\u4FEE\u6539\u5931\u8D25: ".concat((u==null?void 0:u.message)||"\u672A\u77E5\u9519\u8BEF")),a.next=20;break;case 16:a.prev=16,a.t0=a.catch(8),console.error("\u4FEE\u6539\u5BC6\u7801\u9519\u8BEF:",a.t0),o.ZP.error("\u5BC6\u7801\u4FEE\u6539\u5931\u8D25: ".concat(a.t0 instanceof Error?a.t0.message:"\u672A\u77E5\u9519\u8BEF"));case 20:return a.prev=20,A(!1),a.finish(20);case 23:case"end":return a.stop()}},d,null,[[8,16,20,23]])}));return function(l){return t.apply(this,arguments)}}(),te=[{key:"profile",label:"\u4E2A\u4EBA\u8D44\u6599",children:(0,e.jsxs)(i.Z,{form:g,layout:"vertical",onFinish:le,children:[(0,e.jsx)(i.Z.Item,{label:"\u5934\u50CF\u94FE\u63A5",name:"memberAvatar",extra:"\u8BF7\u8F93\u5165\u6709\u6548\u7684\u56FE\u7247URL\u5730\u5740\uFF0C\u5EFA\u8BAE\u4F7F\u7528HTTPS\u94FE\u63A5",initialValue:(r==null?void 0:r.memberAvatar)||"",children:(0,e.jsx)(v.Z,{placeholder:"\u8BF7\u8F93\u5165\u5934\u50CF\u94FE\u63A5"})}),(0,e.jsx)(i.Z.Item,{label:"\u7528\u6237\u540D",name:"memberName",initialValue:(r==null?void 0:r.memberName)||"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},{max:12,message:"\u7528\u6237\u540D\u4E0D\u80FD\u8D85\u8FC712\u4E2A\u5B57\u7B26"}],children:(0,e.jsx)(v.Z,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"})}),(0,e.jsx)(i.Z.Item,{label:"\u6027\u522B",name:"gender",initialValue:(r==null?void 0:r.gender)||0,children:(0,e.jsxs)(B.ZP.Group,{children:[(0,e.jsx)(B.ZP,{value:0,children:"\u4FDD\u5BC6"}),(0,e.jsx)(B.ZP,{value:1,children:"\u7537"}),(0,e.jsx)(B.ZP,{value:2,children:"\u5973"})]})}),(0,e.jsxs)(i.Z.Item,{children:[(0,e.jsx)(y.ZP,{type:"primary",htmlType:"submit",loading:T,children:"\u4FDD\u5B58\u8BBE\u7F6E"}),(0,e.jsx)(y.ZP,{style:{marginLeft:8},onClick:function(){return history.back()},children:"\u8FD4\u56DE"})]})]})},{key:"password",label:"\u4FEE\u6539\u5BC6\u7801",children:(0,e.jsxs)(i.Z,{form:L,layout:"vertical",onFinish:ie,children:[(0,e.jsx)(i.Z.Item,{label:"\u539F\u5BC6\u7801",name:"oldPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u539F\u5BC6\u7801"},{min:6,message:"\u5BC6\u7801\u957F\u5EA6\u4E0D\u80FD\u5C0F\u4E8E6\u4F4D"}],children:(0,e.jsx)(v.Z.Password,{placeholder:"\u8BF7\u8F93\u5165\u539F\u5BC6\u7801",prefix:(0,e.jsx)(I.Z,{})})}),(0,e.jsx)(i.Z.Item,{label:"\u65B0\u5BC6\u7801",name:"newPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"},{min:8,message:"\u65B0\u5BC6\u7801\u957F\u5EA6\u4E0D\u80FD\u5C0F\u4E8E8\u4F4D"}],children:(0,e.jsx)(v.Z.Password,{placeholder:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",prefix:(0,e.jsx)(I.Z,{})})}),(0,e.jsx)(i.Z.Item,{label:"\u786E\u8BA4\u65B0\u5BC6\u7801",name:"confirmPassword",dependencies:["newPassword"],rules:[{required:!0,message:"\u8BF7\u786E\u8BA4\u65B0\u5BC6\u7801"},function(t){var d=t.getFieldValue;return{validator:function(u,f){return!f||d("newPassword")===f?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"))}}}],children:(0,e.jsx)(v.Z.Password,{placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801",prefix:(0,e.jsx)(I.Z,{})})}),(0,e.jsx)(i.Z.Item,{children:(0,e.jsx)(y.ZP,{type:"primary",htmlType:"submit",loading:T,danger:!0,children:"\u4FEE\u6539\u5BC6\u7801"})})]})}];return V==="loading"?(0,e.jsx)(Z._z,{title:"\u4E2A\u4EBA\u8BBE\u7F6E",children:(0,e.jsx)(C.Z,{style:{textAlign:"center",padding:"50px"},children:(0,e.jsxs)(k.Z,{direction:"vertical",align:"center",children:[(0,e.jsx)(Q,{style:{fontSize:36},spin:!0}),(0,e.jsx)("div",{style:{marginTop:16},children:"\u7528\u6237\u4FE1\u606F\u52A0\u8F7D\u4E2D..."})]})})}):V==="error"?(0,e.jsx)(Z._z,{title:"\u4E2A\u4EBA\u8BBE\u7F6E",children:(0,e.jsx)(C.Z,{children:(0,e.jsxs)("div",{style:{textAlign:"center",padding:"30px 0"},children:[(0,e.jsx)("div",{style:{fontSize:18,marginBottom:16},children:"\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25"}),(0,e.jsx)(y.ZP,{type:"primary",onClick:function(){return window.location.reload()},children:"\u5237\u65B0\u9875\u9762"})]})})}):(0,e.jsx)(Z._z,{title:"\u4E2A\u4EBA\u8BBE\u7F6E",children:(0,e.jsxs)(C.Z,{children:[(0,e.jsxs)("div",{style:{textAlign:"center",marginBottom:24},children:[(0,e.jsx)(M.Z,{size:100,icon:(0,e.jsx)(X.Z,{}),src:(r==null?void 0:r.memberAvatar)||g.getFieldValue("memberAvatar"),alt:"\u7528\u6237\u5934\u50CF",style:{border:"1px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,e.jsxs)("div",{style:{marginTop:8,fontSize:16,fontWeight:"bold"},children:[(r==null?void 0:r.memberName)||g.getFieldValue("memberName")||"",(r==null?void 0:r.memberRole)==="admin"&&(0,e.jsx)("span",{style:{backgroundColor:"#1890ff",color:"white",fontSize:12,padding:"2px 8px",borderRadius:4,marginLeft:8},children:"\u7BA1\u7406\u5458"})]})]}),(0,e.jsx)($.Z,{}),(0,e.jsx)(G.Z,{items:te,defaultActiveKey:"profile",tabBarStyle:{marginBottom:20}})]})})},q=Y}}]);
