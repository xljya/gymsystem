"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[730],{94149:function(R,j,a){a.d(j,{Z:function(){return S}});var P=a(1413),m=a(67294),y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},F=y,x=a(91146),h=function(o,f){return m.createElement(x.Z,(0,P.Z)((0,P.Z)({},o),{},{ref:f,icon:F}))},p=m.forwardRef(h),S=p},37122:function(R,j,a){a.r(j),a.d(j,{default:function(){return q}});var P=a(15009),m=a.n(P),y=a(99289),F=a.n(y),x=a(5574),h=a.n(x),p=a(90930),S=a(15133),i=a(25040),o=a(2453),f=a(55102),b=a(78045),E=a(83622),C=a(4393),M=a(78957),$=a(68997),k=a(96074),G=a(11941),Z=a(67294),I=a(94149),L=a(1413),H=a(15294),J=a(91146),K=function(D,c){return Z.createElement(J.Z,(0,L.Z)((0,L.Z)({},D),{},{ref:c,icon:H.Z}))},W=Z.forwardRef(K),Y=W,Q=a(87547),w=a(79198),e=a(85893),X=function(){var D=(0,S.useModel)("@@initialState"),c=D.initialState,r=c==null?void 0:c.currentUser,ee=i.Z.useForm(),re=h()(ee,1),g=re[0],ae=i.Z.useForm(),ne=h()(ae,1),N=ne[0],ue=(0,Z.useState)(!1),O=h()(ue,2),U=O[0],A=O[1],se=(0,Z.useState)("loading"),V=h()(se,2),z=V[0],B=V[1],T=function(){var t=F()(m()().mark(function d(){var n;return m()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,(0,w.dY)();case 3:if(n=u.sent,console.log("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u54CD\u5E94\u5B8C\u6574\u5185\u5BB9:",JSON.stringify(n,null,2)),!(n&&n.id&&n.memberAccount)){u.next=12;break}return console.log("\u6210\u529F\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u6570\u636E:",n),g.setFieldsValue({memberName:n.memberName||"",memberAvatar:n.memberAvatar||"",gender:n.gender}),B("ready"),u.abrupt("return",n);case 12:return console.error("\u8FD4\u56DE\u6570\u636E\u4E0D\u662F\u6709\u6548\u7684\u7528\u6237\u4FE1\u606F:",n),B("error"),u.abrupt("return",null);case 15:u.next=22;break;case 17:return u.prev=17,u.t0=u.catch(0),console.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u9519\u8BEF:",u.t0),B("error"),u.abrupt("return",null);case 22:case"end":return u.stop()}},d,null,[[0,17]])}));return function(){return t.apply(this,arguments)}}();(0,Z.useEffect)(function(){console.log("\u4E2A\u4EBA\u8BBE\u7F6E\u9875\u9762\u521D\u59CB\u5316"),console.log("\u5F53\u524D\u7528\u6237\u4FE1\u606F:",r),T().then(function(t){t?console.log("API\u8BF7\u6C42\u6210\u529F\u83B7\u53D6\u6700\u65B0\u7528\u6237\u4FE1\u606F"):r!=null&&r.id&&(console.log("API\u8BF7\u6C42\u5931\u8D25\u4F46currentUser\u5B58\u5728\uFF0C\u4F7F\u7528currentUser\u6570\u636E"),g.setFieldsValue({memberName:r.memberName||"",memberAvatar:r.memberAvatar||"",gender:r.gender}),B("ready"))}).catch(function(t){console.error("\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5F02\u5E38:",t),r!=null&&r.id&&(g.setFieldsValue({memberName:r.memberName||"",memberAvatar:r.memberAvatar||"",gender:r.gender}),B("ready"))})},[r]);var le=function(){var t=F()(m()().mark(function d(n){var v,u;return m()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(r!=null&&r.id){s.next=3;break}return o.ZP.error("\u7528\u6237\u672A\u767B\u5F55"),s.abrupt("return");case 3:return A(!0),console.log("\u63D0\u4EA4\u7684\u4E2A\u4EBA\u8D44\u6599:",n),s.prev=5,s.next=8,(0,w.dV)({memberName:n.memberName,memberAvatar:n.memberAvatar,gender:n.gender});case 8:if(v=s.sent,console.log("\u66F4\u65B0\u4E2A\u4EBA\u8D44\u6599\u54CD\u5E94:",JSON.stringify(v,null,2)),!v){s.next=19;break}if(o.ZP.success("\u66F4\u65B0\u6210\u529F"),!(c!=null&&c.fetchUserInfo)){s.next=17;break}return s.next=15,c.fetchUserInfo();case 15:u=s.sent,u&&(console.log("\u5DF2\u66F4\u65B0\u5168\u5C40\u7528\u6237\u72B6\u6001"),T());case 17:s.next=20;break;case 19:o.ZP.error("\u66F4\u65B0\u5931\u8D25: \u672A\u77E5\u9519\u8BEF");case 20:s.next=26;break;case 22:s.prev=22,s.t0=s.catch(5),console.error("\u66F4\u65B0\u4E2A\u4EBA\u8D44\u6599\u9519\u8BEF:",s.t0),o.ZP.error("\u66F4\u65B0\u5931\u8D25: ".concat(s.t0 instanceof Error?s.t0.message:"\u672A\u77E5\u9519\u8BEF"));case 26:return s.prev=26,A(!1),s.finish(26);case 29:case"end":return s.stop()}},d,null,[[5,22,26,29]])}));return function(n){return t.apply(this,arguments)}}(),ie=function(){var t=F()(m()().mark(function d(n){var v;return m()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(r!=null&&r.id){l.next=3;break}return o.ZP.error("\u7528\u6237\u672A\u767B\u5F55"),l.abrupt("return");case 3:if(n.newPassword===n.confirmPassword){l.next=6;break}return o.ZP.error("\u4E24\u6B21\u8F93\u5165\u7684\u65B0\u5BC6\u7801\u4E0D\u4E00\u81F4"),l.abrupt("return");case 6:return A(!0),console.log("\u63D0\u4EA4\u5BC6\u7801\u4FEE\u6539\u8BF7\u6C42"),l.prev=8,l.next=11,(0,w.BG)({oldPassword:n.oldPassword,newPassword:n.newPassword,checkPassword:n.confirmPassword});case 11:v=l.sent,console.log("\u4FEE\u6539\u5BC6\u7801\u54CD\u5E94:",JSON.stringify(v,null,2)),v?(o.ZP.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),N.resetFields()):o.ZP.error("\u5BC6\u7801\u4FEE\u6539\u5931\u8D25: \u672A\u77E5\u9519\u8BEF"),l.next=20;break;case 16:l.prev=16,l.t0=l.catch(8),console.error("\u4FEE\u6539\u5BC6\u7801\u9519\u8BEF:",l.t0),o.ZP.error("\u5BC6\u7801\u4FEE\u6539\u5931\u8D25: ".concat(l.t0 instanceof Error?l.t0.message:"\u672A\u77E5\u9519\u8BEF"));case 20:return l.prev=20,A(!1),l.finish(20);case 23:case"end":return l.stop()}},d,null,[[8,16,20,23]])}));return function(n){return t.apply(this,arguments)}}(),te=[{key:"profile",label:"\u4E2A\u4EBA\u8D44\u6599",children:(0,e.jsxs)(i.Z,{form:g,layout:"vertical",onFinish:le,children:[(0,e.jsx)(i.Z.Item,{label:"\u5934\u50CF\u94FE\u63A5",name:"memberAvatar",extra:"\u8BF7\u8F93\u5165\u6709\u6548\u7684\u56FE\u7247URL\u5730\u5740\uFF0C\u5EFA\u8BAE\u4F7F\u7528HTTPS\u94FE\u63A5",initialValue:(r==null?void 0:r.memberAvatar)||"",children:(0,e.jsx)(f.Z,{placeholder:"\u8BF7\u8F93\u5165\u5934\u50CF\u94FE\u63A5"})}),(0,e.jsx)(i.Z.Item,{label:"\u7528\u6237\u540D",name:"memberName",initialValue:(r==null?void 0:r.memberName)||"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},{max:12,message:"\u7528\u6237\u540D\u4E0D\u80FD\u8D85\u8FC712\u4E2A\u5B57\u7B26"}],children:(0,e.jsx)(f.Z,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"})}),(0,e.jsx)(i.Z.Item,{label:"\u6027\u522B",name:"gender",initialValue:(r==null?void 0:r.gender)||0,children:(0,e.jsxs)(b.ZP.Group,{children:[(0,e.jsx)(b.ZP,{value:0,children:"\u4FDD\u5BC6"}),(0,e.jsx)(b.ZP,{value:1,children:"\u7537"}),(0,e.jsx)(b.ZP,{value:2,children:"\u5973"})]})}),(0,e.jsxs)(i.Z.Item,{children:[(0,e.jsx)(E.ZP,{type:"primary",htmlType:"submit",loading:U,children:"\u4FDD\u5B58\u8BBE\u7F6E"}),(0,e.jsx)(E.ZP,{style:{marginLeft:8},onClick:function(){return history.back()},children:"\u8FD4\u56DE"})]})]})},{key:"password",label:"\u4FEE\u6539\u5BC6\u7801",children:(0,e.jsxs)(i.Z,{form:N,layout:"vertical",onFinish:ie,children:[(0,e.jsx)(i.Z.Item,{label:"\u539F\u5BC6\u7801",name:"oldPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u539F\u5BC6\u7801"},{min:8,message:"\u5BC6\u7801\u957F\u5EA6\u4E0D\u80FD\u5C0F\u4E8E8\u4F4D"}],children:(0,e.jsx)(f.Z.Password,{placeholder:"\u8BF7\u8F93\u5165\u539F\u5BC6\u7801",prefix:(0,e.jsx)(I.Z,{})})}),(0,e.jsx)(i.Z.Item,{label:"\u65B0\u5BC6\u7801",name:"newPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"},{min:8,message:"\u65B0\u5BC6\u7801\u957F\u5EA6\u4E0D\u80FD\u5C0F\u4E8E8\u4F4D"}],children:(0,e.jsx)(f.Z.Password,{placeholder:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",prefix:(0,e.jsx)(I.Z,{})})}),(0,e.jsx)(i.Z.Item,{label:"\u786E\u8BA4\u65B0\u5BC6\u7801",name:"confirmPassword",dependencies:["newPassword"],rules:[{required:!0,message:"\u8BF7\u786E\u8BA4\u65B0\u5BC6\u7801"},function(t){var d=t.getFieldValue;return{validator:function(v,u){return!u||d("newPassword")===u?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4"))}}}],children:(0,e.jsx)(f.Z.Password,{placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801",prefix:(0,e.jsx)(I.Z,{})})}),(0,e.jsx)(i.Z.Item,{children:(0,e.jsx)(E.ZP,{type:"primary",htmlType:"submit",loading:U,danger:!0,children:"\u4FEE\u6539\u5BC6\u7801"})})]})}];return z==="loading"?(0,e.jsx)(p._z,{title:"\u4E2A\u4EBA\u8BBE\u7F6E",children:(0,e.jsx)(C.Z,{style:{textAlign:"center",padding:"50px"},children:(0,e.jsxs)(M.Z,{direction:"vertical",align:"center",children:[(0,e.jsx)(Y,{style:{fontSize:36},spin:!0}),(0,e.jsx)("div",{style:{marginTop:16},children:"\u7528\u6237\u4FE1\u606F\u52A0\u8F7D\u4E2D..."})]})})}):z==="error"?(0,e.jsx)(p._z,{title:"\u4E2A\u4EBA\u8BBE\u7F6E",children:(0,e.jsx)(C.Z,{children:(0,e.jsxs)("div",{style:{textAlign:"center",padding:"30px 0"},children:[(0,e.jsx)("div",{style:{fontSize:18,marginBottom:16},children:"\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25"}),(0,e.jsx)(E.ZP,{type:"primary",onClick:function(){return window.location.reload()},children:"\u5237\u65B0\u9875\u9762"})]})})}):(0,e.jsx)(p._z,{title:"\u4E2A\u4EBA\u8BBE\u7F6E",children:(0,e.jsxs)(C.Z,{children:[(0,e.jsxs)("div",{style:{textAlign:"center",marginBottom:24},children:[(0,e.jsx)($.Z,{size:100,icon:(0,e.jsx)(Q.Z,{}),src:(r==null?void 0:r.memberAvatar)||g.getFieldValue("memberAvatar"),alt:"\u7528\u6237\u5934\u50CF",style:{border:"1px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,e.jsxs)("div",{style:{marginTop:8,fontSize:16,fontWeight:"bold"},children:[(r==null?void 0:r.memberName)||g.getFieldValue("memberName")||"",(r==null?void 0:r.memberRole)==="admin"&&(0,e.jsx)("span",{style:{backgroundColor:"#1890ff",color:"white",fontSize:12,padding:"2px 8px",borderRadius:4,marginLeft:8},children:"\u7BA1\u7406\u5458"})]})]}),(0,e.jsx)(k.Z,{}),(0,e.jsx)(G.Z,{items:te,defaultActiveKey:"profile",tabBarStyle:{marginBottom:20}})]})})},q=X}}]);
